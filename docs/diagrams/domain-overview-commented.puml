@startuml
title üìö Syst√®me Hadron ‚Äì Version Comment√©e (p√©dagogique)

' ===========================
' CONTEXTE 1 - PRODUCTION DE QUARKS
' ===========================
package "ParticleBC (Production de Quarks)" {

  class QuarkAggregate {
    - id: QuarkId
    - type: QuarkType
    - isAntiparticle: bool
    + register(type: string, isAntiparticle: bool)
  }

  note right of QuarkAggregate
    Ici, les quarks sont cr√©√©s officiellement.
    La cr√©ation suit les r√®gles m√©tier valid√©es.
  end note

  interface QuarkWriteRepositoryInterface
  interface QuarkReadRepositoryInterface

  class QuarkCreated <<event>>

  note bottom of QuarkCreated
    Un √©v√©nement historique immuable.
    Trace qu'un quark a √©t√© cr√©√©.
  end note
}

' ===========================
' CONTEXTE 2 - ASSEMBLAGE DE HADRONS
' ===========================
package "HadronBC (Assemblage de Hadrons)" {

  class HadronAggregate {
    - quarkIds: QuarkId[]
    - type: string
    + create(quarkIds: QuarkId[], type: string)
  }

  note right of HadronAggregate
    Compose plusieurs quarks pour cr√©er
    une particule plus complexe.
  end note

  class HadronCompositionPolicy {
    + validate(quarkIds: QuarkId[]): bool
  }

  note bottom of HadronCompositionPolicy
    R√®gles scientifiques :
    - 3 quarks => Baryon
    - 2 quarks dont 1 antiquark => M√©son
  end note

  class HadronCreationService {
    + assemble(quarkIds: QuarkId[])
  }

  class HadronCreated <<event>>
}

' ===========================
' INFRASTRUCTURE TECHNIQUE
' ===========================
package "Infrastructure" {
  class InMemoryQuarkRepository
  class InMemoryHadronRepository
  class InMemoryEventStore
  class QuarkProjectionRepository
}

' ===========================
' RELATIONS
' ===========================

QuarkAggregate --> QuarkCreated : emits
QuarkAggregate --> QuarkWriteRepositoryInterface
QuarkWriteRepositoryInterface ..> InMemoryQuarkRepository

QuarkCreated ..> InMemoryEventStore : stored as event

InMemoryEventStore --> QuarkProjectionRepository : projection

QuarkProjectionRepository ..> HadronCompositionPolicy : fournit les quarks
HadronCompositionPolicy --> HadronCreationService : si valides
HadronCreationService --> HadronCreated : emits
HadronCreationService --> HadronWriteRepositoryInterface
HadronWriteRepositoryInterface ..> InMemoryHadronRepository
@enduml
