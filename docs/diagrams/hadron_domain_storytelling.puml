@startuml
title ðŸ“š Hadron System â€“ Domain Storytelling (PÃ©dagogique)

' =====================================================
' CONTEXTE 1 â€“ Production des Quarks
' =====================================================
package "ParticleBC (Quark Factory)" {

  class QuarkAggregate {
    - id: QuarkId
    - type: QuarkType
    - isAntiparticle: bool
    + register(type, isAntiparticle)
  }

  note right of QuarkAggregate
    La "source de vÃ©ritÃ©" des quarks.
    Chaque crÃ©ation est validÃ©e.
  end note

  class QuarkCreated <<event>>
  note bottom of QuarkCreated
    Historique immuable :
    un quark a Ã©tÃ© crÃ©Ã©.
  end note
}

' =====================================================
' CONTEXTE 2 â€“ Assemblage des Hadrons
' =====================================================
package "HadronBC (Hadron Lab)" {

  class HadronAggregate {
    - quarkIds: QuarkId[]
    - type: string
    + create(quarkIds, type)
  }

  note right of HadronAggregate
    Regroupe les quarks pour former des hadrons.
  end note

  class HadronCompositionPolicy {
    + validate(quarkIds): bool
  }

  note bottom of HadronCompositionPolicy
    RÃ¨gles :
    - 3 quarks â†’ Baryon
    - 2 quarks (1 antiquark) â†’ MÃ©son
  end note

  class HadronCreationService {
    + assemble(quarkIds)
  }

  class HadronCreated <<event>>
}

' =====================================================
' Infrastructure simplifiÃ©e
' =====================================================
package "Infrastructure" {
  class InMemoryQuarkRepository
  class InMemoryHadronRepository
  class InMemoryEventStore
  class QuarkProjectionRepository
}

' =====================================================
' Flux et relations
' =====================================================
QuarkAggregate --> QuarkCreated : crÃ©e
QuarkCreated ..> InMemoryEventStore : stockÃ©
InMemoryEventStore --> QuarkProjectionRepository : projection

QuarkProjectionRepository ..> HadronCompositionPolicy : fournit quarks
HadronCompositionPolicy --> HadronCreationService : valide
HadronCreationService --> HadronCreated : crÃ©e
HadronCreationService --> InMemoryHadronRepository : sauvegarde

@enduml
